<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Olivier Guyon" />
  <title>AOloopControl</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; background-color: #dddddd; }
td.sourceCode { padding-left: 5px; }
code > span.kw { font-weight: bold; } /* Keyword */
code > span.dt { color: #800000; } /* DataType */
code > span.dv { color: #0000ff; } /* DecVal */
code > span.bn { color: #0000ff; } /* BaseN */
code > span.fl { color: #800080; } /* Float */
code > span.ch { color: #ff00ff; } /* Char */
code > span.st { color: #dd0000; } /* String */
code > span.co { color: #808080; font-style: italic; } /* Comment */
code > span.al { color: #00ff00; font-weight: bold; } /* Alert */
code > span.fu { color: #000080; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #ff0000; font-weight: bold; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #ff00ff; } /* SpecialChar */
code > span.vs { color: #dd0000; } /* VerbatimString */
code > span.ss { color: #dd0000; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { font-weight: bold; } /* Preprocessor */
code > span.at { } /* Attribute */
code > span.do { color: #808080; font-style: italic; } /* Documentation */
code > span.an { color: #808080; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #808080; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #808080; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="/home/olivier/.css/pandoc.css" type="text/css" />
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
</head>
<body>
<div id="header">
<h1 class="title">AOloopControl</h1>
<h2 class="author">Olivier Guyon</h2>
<h3 class="date">Aug 9, 2016</h3>
</div>
<div id="TOC">
<ul>
<li><a href="#overview"><span class="toc-section-number">1</span> Overview</a><ul>
<li><a href="#scope"><span class="toc-section-number">1.1</span> Scope</a></li>
<li><a href="#usage"><span class="toc-section-number">1.2</span> Usage</a></li>
<li><a href="#supporting-scripts-aolconfscripts-directory"><span class="toc-section-number">1.3</span> Supporting scripts, aolconfscripts directory</a></li>
<li><a href="#supporting-scripts-auxscripts-directory"><span class="toc-section-number">1.4</span> Supporting scripts, auxscripts directory</a></li>
<li><a href="#hardware-simulation-scripts"><span class="toc-section-number">1.5</span> Hardware simulation scripts</a></li>
</ul></li>
<li><a href="#hardware-simulation"><span class="toc-section-number">2</span> Hardware Simulation</a><ul>
<li><a href="#overview-1"><span class="toc-section-number">2.1</span> Overview</a></li>
<li><a href="#processes-and-scripts-main-wf-control-loop"><span class="toc-section-number">2.2</span> Processes and scripts: main WF control loop</a><ul>
<li><a href="#process-aosimmkwf"><span class="toc-section-number">2.2.1</span> Process <code>aosimmkWF</code></a></li>
<li><a href="#process-aosimdmrun"><span class="toc-section-number">2.2.2</span> Process <code>aosimDMrun</code></a></li>
<li><a href="#process-aosimpyrwfs"><span class="toc-section-number">2.2.3</span> Process <code>aosimPyrWFS</code></a></li>
</ul></li>
<li><a href="#ao-loop-control"><span class="toc-section-number">2.3</span> AO loop control</a><ul>
<li><a href="#shared-memory-streams"><span class="toc-section-number">2.3.1</span> Shared memory streams</a></li>
<li><a href="#hardware-simulation-architecture"><span class="toc-section-number">2.3.2</span> Hardware simulation architecture</a></li>
<li><a href="#dm-temporal-response"><span class="toc-section-number">2.3.3</span> DM temporal response</a></li>
</ul></li>
<li><a href="#processes-and-scripts-system-ouput"><span class="toc-section-number">2.4</span> Processes and scripts: system ouput</a><ul>
<li><a href="#process-aosimcorolowfs"><span class="toc-section-number">2.4.1</span> Process <code>aosimcoroLOWFS</code></a></li>
<li><a href="#ouput-simulation-architecture"><span class="toc-section-number">2.4.2</span> Ouput simulation architecture</a></li>
</ul></li>
</ul></li>
<li><a href="#aoloopcontrol-setup"><span class="toc-section-number">3</span> AOloopControl setup</a><ul>
<li><a href="#files"><span class="toc-section-number">3.1</span> Files</a></li>
<li><a href="#gui-description"><span class="toc-section-number">3.2</span> GUI description</a></li>
<li><a href="#setting-up-the-hardware-interfaces"><span class="toc-section-number">3.3</span> Setting up the hardware interfaces</a></li>
<li><a href="#acquiring-a-response-matrix"><span class="toc-section-number">3.4</span> Acquiring a response matrix</a></li>
</ul></li>
</ul>
</div>
<div id="overview" class="section level1">
<h1><span class="header-section-number">1</span> Overview</h1>
<div id="scope" class="section level2">
<h2><span class="header-section-number">1.1</span> Scope</h2>
<p>AO loop control package</p>
</div>
<div id="usage" class="section level2">
<h2><span class="header-section-number">1.2</span> Usage</h2>
<p>Scripts to run the software are located within the source code directory:</p>
<pre><code>./src/AOloopControl/scripts/</code></pre>
<p>The scripts can be linked to your working directory by executing the following command:</p>
<pre><code>ln -s $PWD/syncscripts /myworkdirectory/syncscripts</code></pre>
<p>Then, execute in your work directory:</p>
<pre><code>./syncscripts</code></pre>
<p>This will install all required scripts in workdirectory and install any packages required.</p>
<p>The main script is</p>
<pre><code>./aolconf</code></pre>
</div>
<div id="supporting-scripts-aolconfscripts-directory" class="section level2">
<h2><span class="header-section-number">1.3</span> Supporting scripts, aolconfscripts directory</h2>
<p>Scripts in the <code>aolconfscripts</code> directory are part of the high-level ASCII control GUI</p>
<table>
<colgroup>
<col width="34%" />
<col width="65%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Script</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>aolconf_DMfuncs</strong></td>
<td align="left">DM functions</td>
</tr>
<tr class="even">
<td align="left"><strong>aolconf_DMturb</strong></td>
<td align="left">DM turbulence functions</td>
</tr>
<tr class="odd">
<td align="left"><strong>aolconf_funcs</strong></td>
<td align="left">Misc functions</td>
</tr>
<tr class="even">
<td align="left"><strong>aolconf_logfuncs</strong></td>
<td align="left">data and command logging</td>
</tr>
<tr class="odd">
<td align="left"><strong>aolconf_menuconfigureloop</strong></td>
<td align="left">configure loop menu</td>
</tr>
<tr class="even">
<td align="left"><strong>aolconf_menucontrolloop</strong></td>
<td align="left">control loop menu</td>
</tr>
<tr class="odd">
<td align="left"><strong>aolconf_menucontrolmatrix</strong></td>
<td align="left">control matrix menu</td>
</tr>
<tr class="even">
<td align="left"><strong>aolconf_menu_mkFModes</strong></td>
<td align="left">Make modes</td>
</tr>
<tr class="odd">
<td align="left"><strong>aolconf_menurecord</strong></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><strong>aolconf_menutestmode</strong></td>
<td align="left">Test mode menu</td>
</tr>
<tr class="odd">
<td align="left"><strong>aolconf_menutop</strong></td>
<td align="left">Top level menu</td>
</tr>
<tr class="even">
<td align="left"><strong>aolconf_menuview</strong></td>
<td align="left">Data view menu</td>
</tr>
<tr class="odd">
<td align="left"><strong>aolconf_readconf</strong></td>
<td align="left">Configuration read functions</td>
</tr>
<tr class="even">
<td align="left"><strong>aolconf_template</strong></td>
<td align="left">Template (not used)</td>
</tr>
</tbody>
</table>
</div>
<div id="supporting-scripts-auxscripts-directory" class="section level2">
<h2><span class="header-section-number">1.4</span> Supporting scripts, auxscripts directory</h2>
<p>Scripts in the <code>auxscripts</code> directory are called by aolconf to perform various tasks.</p>
<table>
<colgroup>
<col width="34%" />
<col width="65%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Script</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>acquRespM</strong></td>
<td align="left">Acquire response matrix</td>
</tr>
</tbody>
</table>
</div>
<div id="hardware-simulation-scripts" class="section level2">
<h2><span class="header-section-number">1.5</span> Hardware simulation scripts</h2>
<p>SCripts in the <code>aohardsim</code> directory are called to simulate hardware for testing / simulations</p>
<table>
<colgroup>
<col width="34%" />
<col width="65%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Script</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>aosimDMstart</strong></td>
<td align="left">Start simulation DM shared mem</td>
</tr>
<tr class="even">
<td align="left"><strong>aosimDMrun</strong></td>
<td align="left">Simulates physical deformable mirror (DM)</td>
</tr>
<tr class="odd">
<td align="left"><strong>aosimmkWF</strong></td>
<td align="left">creates properly sized wavefronts from pre-computed wavefronts</td>
</tr>
<tr class="even">
<td align="left"><strong>aosimWPyrFS</strong></td>
<td align="left">Simulates WFS</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="hardware-simulation" class="section level1">
<h1><span class="header-section-number">2</span> Hardware Simulation</h1>
<div id="overview-1" class="section level2">
<h2><span class="header-section-number">2.1</span> Overview</h2>
<p>The AOsim simulation architecture relies on individual processes that simulate subsystems. Each process is launched by a bash script. ASCII configuration files are read by each process. Data I/O can be done with low latency using shared memory and semaphores: a process operation (for example, the wavefront sensor process computing WFS signals) is typically triggered by a semaphore contained in the shared memory wavefront stream. A low-speed file system based alternative to shared memory and semaphores is also provided.</p>
</div>
<div id="processes-and-scripts-main-wf-control-loop" class="section level2">
<h2><span class="header-section-number">2.2</span> Processes and scripts: main WF control loop</h2>
<div id="process-aosimmkwf" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Process <code>aosimmkWF</code></h3>
<p><code>aosimmkWF</code> reads precomputed wavefronts and formats them for the simulations (pixel scale, temporal sampling).</p>
<p>Parameters for <code>aosimmkWF</code> are stored in configuration file:</p>
<p>File <code>aosimmkWF.conf.default</code> :</p>
<div class="sourceCode"><table class="sourceCode numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="sourceCode"><pre><code class="sourceCode"># ======== AO simulation : creating atmospheric wavefronts stream =================
# script relies on pre-computed physical atmospheric wavefronts


MODE             0                # 0: read pre-computed WFs, 1: empty WFs
WFDIR            ./atmwf          # atmospheric wavefronts directory

LAMBDANM         1600             # wavelength [nm]

# ============== OUTPUT TYPE (OPD unit = um) ====================
OUT0FITSFILE         0                # 0: none, 1 if FITS file output OPD only, 2 if OPD+AMP
OUT0FITSFILENAMEOPD  wf0opd.fits       # FITS file name output (OPD)
OUT0FITSFILENAMEAMP  wf0amp.fits       # FITS file name output (AMP)
OUT0STREAM           1                # 1 if shared memory stream OPD only, 2 if OPD+AMP 
OUT0STREAMNAMEOPD    wf0opd           # output WF stream name (OPD)
OUT0STREAMNAMEAMP    wf0amp           # output WF stream name (AMP)

# ============== PROCESS TRIGGER ==================================
TRIGGERMODE           1                # 0: file, 1: semaphore from stream, 2: time interval
TRIGGERFILE           wfup.txt         # update file name (TRIGGERMODE=0,1
TRIGGERDT             0.1              # update interval (TRIGGERMODE=0,2)
TRIGGER0STREAM        WFSinst          # trigger stream
TRIGGER0SEM           5                # trigger semaphore in TRIGGERSTREAM
TRIGGER1STREAM        dm05dispmap      # trigger stream
TRIGGER1SEM           5                # trigger semaphore in TRIGGERSTREAM

# ============== PARAMETERS ======================================
DT                    0.0003           # time interval between computed wavefronts
OPDMFACT              0.01             # OPD multiplicative factor
AMPMFACT              1.0              # AMP multiplicative factor
ARRAYSIZE             128              # output size [pix]
PIXSCALEMODE          2                # 0: adopt input WF pixel scale, 1: custom pixel scale, 2: bin
PIXSCALECUSTOM        0.1              # custom pixel size
PIXBINFACTOR          4                # bin factor
PUPDIAMM              8                # Pupil diameter [m]

# ============== POST-PROCESSING =============================
DM0MODE               1               # 0 if no DM0, 1 if OPD DMn
DM0NAME               dm05dispmap     # DM displacement map stream
OUT1FITSFILENAMEOPD  wf1opd.fits       # FITS file name output (OPD)
OUT1FITSFILENAMEAMP  wf1amp.fits       # FITS file name output (AMP)
OUT1STREAM           1                # 1 if shared memory stream OPD only, 2 if OPD+AMP 
OUT1STREAMNAMEOPD     wf1opd          # output WF stream name (OPD)
OUT1STREAMNAMEAMP     wf1amp          # output WF stream name (AMP)</code></pre></td></tr></table></div>
</div>
<div id="process-aosimdmrun" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Process <code>aosimDMrun</code></h3>
<p>File <code>aosimDMrun.conf.default</code> :</p>
<div class="sourceCode"><table class="sourceCode numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="sourceCode"><pre><code class="sourceCode"># ============== AOsim: DM process =============================
# DM process is triggered by WF OPD, not by DM command

# ============== INPUT &amp; TRIGGER (OPD unit = um) ===============
INMODE                   0                 # 0:stream, 1:file system (FITS)
INSTREAMNAMEDM           dm05disp          # input DM command stream
INFITSFILENAMEDM         dm05disp.fits     # input FITS file name (DM command)
INTRIGSTREAMNAME         wf1opd            # input trigger stream
INTRIGSEMCHAN            6                 # input semaphore channel (using OPD input)
INTRIGGERFILE            inwf.txt          # input trigger file

# ============== OUTPUT TYPE ===================================
OUTMODE                  0                 # 0: stream, 1: file system
OUTSTREAMNAMEDM          dm05dispmap       # output WF stream name 
OUTFITSFILENAMEDM        dm05dispmap.fits  # FITS file name output [um]
OUTTRIGGERFILE           outdm.txt         # output trigger file

# ============== GEOMETRY, TIME =============================
ARRAYSIZE                128               # array size, pix
DMRAD                    52                # DM radius on array
DMDT                     0.0003            # DM time sampling
NBTSAMPLES               100               # number of time samples
DMLAGSTART               0.0003            # time lag start
DMTIMECST                0.0001            # DM time constant</code></pre></td></tr></table></div>
</div>
<div id="process-aosimpyrwfs" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Process <code>aosimPyrWFS</code></h3>
<p>File <code>aosimPyrWFS.conf.default</code> :</p>
<div class="sourceCode"><table class="sourceCode numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="sourceCode"><pre><code class="sourceCode">
LAMBDANM          800             # wavelength [nm]

# ============== INPUT TYPE (OPD unit = um) ====================
INMODE                   0                 # 0:stream, 1:file system (FITS)
INSTREAMNAMEOPD          wf1opd            # input OPD stream
INSTREAMNAMEAMP          wf1amp            # input AMP stream
INSEMCHAN                5                 # input semaphore channel (using OPD input)
INFITSFILENAMEOPD        inwfopd.fits      # input FITS file name (OPD)
INFITSFILENAMEAMP        inwfamp.fits      # input FITS file name (AMP)
INTRIGGERFILE            inwf.txt          # input trigger file

# ============== OUTPUT TYPE ===================================
OUTMODE                  0                 # 0: stream, 1: file system
OUTSTREAMNAME            pWFSim            # output image stream name 
OUTINSTSTREAMNAME        WFSinst           # output instantaneous image stream name 
OUTFITSFILENAME          PyrWFS_im.fits    # FITS file name output (intensity)
OUTTRIGGERFILE           outpyr.txt        # output trigger file

# ============== FREQUENCY, GEOMETRY =============================
ARRAYSIZE                256               # array size for computations
PYRMODMODE               1                 # 0: no modulation, 1: modulation
PYRMODAMP                0.0               # Modulation radius [l/D]
PYRMODNBPT               1                 # number of pyramid modulation points
PYRAPERTURE              50.0              # spatial filter aperture [l/D]
PUPPIXDIAM               100.0             # pupil diameter [pix] - used to compute l/D scale
PYRPUPSEP                1.2               # separation between pupil imagees (relative to pup diam)
OUTBINFACT               2                 # output binning factor
OUTARRAYSIZE             120               # output array size</code></pre></td></tr></table></div>
</div>
</div>
<div id="ao-loop-control" class="section level2">
<h2><span class="header-section-number">2.3</span> AO loop control</h2>
<p>The <code>aolconf</code> script is used to configure and launch the AO control loop. It can be configured with input/output from real hardware or a simulation of real hardware.</p>
<div id="shared-memory-streams" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Shared memory streams</h3>
<table>
<colgroup>
<col width="34%" />
<col width="65%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Script</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>wf0opd</strong></td>
<td align="left">Wavefront OPD prior to wavefront correction</td>
</tr>
<tr class="even">
<td align="left"><strong>wf1opd</strong></td>
<td align="left">Wavefront OPD after correction (=wf0opd-2xdm05dispmap)</td>
</tr>
<tr class="odd">
<td align="left"><strong>dm05disp</strong></td>
<td align="left">DM actuators positions</td>
</tr>
<tr class="even">
<td align="left"><strong>dm05dispmap</strong></td>
<td align="left">DM OPD map</td>
</tr>
<tr class="odd">
<td align="left"><strong>WFSinst</strong></td>
<td align="left">Instantaneous WFS intensity</td>
</tr>
<tr class="even">
<td align="left"><strong>pWFSint</strong></td>
<td align="left">WFS intensity frame, time averaged to WFS frame rate and sampled to WFS camera pixels</td>
</tr>
</tbody>
</table>
</div>
<div id="hardware-simulation-architecture" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Hardware simulation architecture</h3>
<div class="figure">
<img src="./figures/aosimlink.jpg" title="aosim data flow" alt="data flow" />
<p class="caption">data flow</p>
</div>
<p>Close-loop simulation requires the following scripts to be launched to simulate the hardware, in the following order :</p>
<ul>
<li><code>aosimDMstart</code>: This script creates DM channels (uses dm index 5 for simulation). Shared memory arrays <code>dm05disp00</code> to <code>dm05disp11</code> are created, along with the total displacement <code>dm05disp</code>. Also creates the <code>wf1opd</code> shared memory stream which is needed by <code>aosimDMrun</code> and will be updated by runWF. <code>wf1opd</code> is the master clock for the whole simulation, as it triggers DM shape computation and WFS image computation.</li>
<li><code>aosimDMrun</code>: Simulates physical deformable mirror (DM)</li>
<li><code>aosimmkWF</code>: Creates atmospheric wavefronts</li>
<li><code>aosimWFS</code>: Simulates WFS</li>
</ul>
<p>Some key script variables need to coordinated between scripts. The following WF array size should match :</p>
<ul>
<li><code>WFsize</code> in script <code>aosimDMstart</code></li>
<li><code>ARRAYSIZE</code> in <code>aosimmkWF.conf</code></li>
<li><code>ARRAYSIZE</code> in <code>aosimDMrun.conf</code></li>
</ul>
<p>The main hardware loop is between <code>aosimmkWF</code> and <code>aosimWFS</code>: computation of a wavefront by <code>aosimmkWF</code> is <em>triggered</em> by completion of a WFS instantaneous image computation by <code>aosimWFS</code>. The configuration files are configured for this link.</p>
</div>
<div id="dm-temporal-response" class="section level3">
<h3><span class="header-section-number">2.3.3</span> DM temporal response</h3>
<p>The DM temporal response is assumed to be such that the distance between the current position <span class="math inline">\(p\)</span> and desired displacement <span class="math inline">\(c\)</span> values is multiplided by coefficient <span class="math inline">\(a&lt;1\)</span> at each time step <span class="math inline">\(dt\)</span>. The corresponding step response is :</p>
<p><span class="math inline">\(c - p((k+1) dt) = (c - p(k dt)) a\)</span></p>
<p><span class="math inline">\(c - p(k dt) = (c-p0) a^k\)</span></p>
<p><span class="math inline">\(p(k dt) = 1-a^k\)</span></p>
<p>The corresponding time constant is</p>
<p><span class="math inline">\(a^{\frac{t0}{dt}} = 0.5\)</span></p>
<p><span class="math inline">\(\frac{t0}{dt} ln(a) = ln(0.5)\)</span></p>
<p><span class="math inline">\(ln(a) = ln(0.5) dt/t0\)</span></p>
<p><span class="math inline">\(a = 0.5^{\frac{dt}{t0}}\)</span></p>
</div>
</div>
<div id="processes-and-scripts-system-ouput" class="section level2">
<h2><span class="header-section-number">2.4</span> Processes and scripts: system ouput</h2>
<p>The output (corrected) wavefront is processed to compute ouput focal plane images, and optionally LOWFS image.</p>
<div id="process-aosimcorolowfs" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Process <code>aosimcoroLOWFS</code></h3>
<p>Computes coronagraphic image output and LOWFS image</p>
<p>File <code>aosimcoroLOWFS.conf.default</code>:</p>
<div class="sourceCode"><table class="sourceCode numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="sourceCode"><pre><code class="sourceCode">
# ============== AOsim: coro LOWFS process =============================
# LOWFS process is triggered by WF OPD

# ============== INPUT &amp; TRIGGER (OPD unit = um) ===============
INMODE                   0                 # 0:stream, 1:file system (FITS)
INAMPSTREAMNAME          wf1amp            # input AMP stream
INOPDSTREAMNAME          wf1opd            # input OPD stream
INAMPFITSFILENAME        wf1amp.fits       # input FITS file name
INOPDFITSFILENAME        wf1opd.fits       # input FITS file name
INTRIGSTREAMNAME         wf1opd            # input trigger stream
INTRIGSEMCHAN            4                 # input semaphore channel (using OPD input)
INTRIGGERFILE            inwf.txt          # input trigger file

# ============== OUTPUT TYPE ===================================
OUTMODE                  0                 # 0: stream, 1: file system
OUTSTREAMNAME            imLOWFSinst       # output WF stream name 
OUTFITSFILENAME          imLOWFSinst.fits  # FITS file name output [um]
OUTTRIGGERFILE           outLOWFS.txt      # output trigger file

# ============== GEOMETRY, OPTICAL DESIGN =============================
LAMBDAum                 1.65              # wavelength [um]
ARRAYSIZE                256               # array size, pix, used for internal computations
COROFPMAMP               corofpmamp        # coronagraph focal plane mask amplitude
COROFPMPHA               corofpmpha        # coronagraph focal plane mask amplitude
LYOTSTOPREFLAMP          lyotstopreflamp   # LYOT stop reflectivity map (amp)
LYOTSTOPREFLPHA          lyotstopreflpha   # LYOT stop reflectivity map (pha)
LYOTSTOPTRANSMAMP        lyotstoptransmamp # LYOT stop transmission map (amp)
LYOTSTOPTRANSMPHA        lyotstoptransmpha # LYOT stop transmission map (pha)
LOWFSOPDMAP              lowfsopdmap       # LOWFS defocus map (um)</code></pre></td></tr></table></div>
</div>
<div id="ouput-simulation-architecture" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Ouput simulation architecture</h3>
<div class="figure">
<img src="./figures/aosimlink_coroLOWFS.jpg" title="coroLOWFS data flow" alt="coroLOWFS data flow" />
<p class="caption">coroLOWFS data flow</p>
</div>
</div>
</div>
</div>
<div id="aoloopcontrol-setup" class="section level1">
<h1><span class="header-section-number">3</span> AOloopControl setup</h1>
<div id="files" class="section level2">
<h2><span class="header-section-number">3.1</span> Files</h2>
<p>SM = shared memory</p>
<table>
<colgroup>
<col width="32%" />
<col width="13%" />
<col width="54%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">File</th>
<th align="left">stream</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>./conf/HRM_DMmask.fits</strong></td>
<td align="left"></td>
<td align="left">DM mask to construct Hadamard RM pokes, created by <strong>auxscripts/mkHpoke</strong> if not present</td>
</tr>
</tbody>
</table>
</div>
<div id="gui-description" class="section level2">
<h2><span class="header-section-number">3.2</span> GUI description</h2>
<p>The script <code>aolconf</code> starts the main GUI, from which all setup and control can be done. The GUI consists of several main screens, as shown below.</p>
<div class="figure">
<img src="./figures/aolconfGUIscreens.jpg" title="GUI screens" alt="aolconf GUI screens" />
<p class="caption">aolconf GUI screens</p>
</div>
</div>
<div id="setting-up-the-hardware-interfaces" class="section level2">
<h2><span class="header-section-number">3.3</span> Setting up the hardware interfaces</h2>
<ul>
<li>start aolconf with loop number and loop name (you can ommit these arguments when launching the script again):</li>
</ul>
<pre><code>aolconf -L 3 -N testsim</code></pre>
<ul>
<li><p><strong>Set DM number</strong> (<code>S</code> command in <code>Top Menu</code> screen). If the DM stream exists, you should see its x and y size in the two lines below. If not, you will need to enter the desired DM size and create the DM stream with the <code>initDM</code> command in the <code>Top Menu</code>.</p></li>
<li><strong>autoconfigure streams</strong> (<code>nolink</code> in <code>Top Menu</code> screen). This command automactically sets up the following symbolic links:
<ul>
<li>dm##disp03 is linked to aol#_dmC (loop dm control channel)</li>
<li>dm##disp00 is linked to aol#_dmO (flat offset channel)</li>
<li>dm##disp04 is linked to aol#_dmZP0 (zero point offset 0 actuation channel)</li>
<li>dm##disp05 is linked to aol#_dmZP1 (zero point offset 1 actuation channel)</li>
<li>dm##disp06 is linked to aol#_dmZP2 (zero point offset 2 actuation channel)</li>
<li>dm##disp07 is linked to aol#_dmZP3 (zero point offset 3 actuation channel)</li>
<li>dm##disp08 is linked to aol#_dmZP4 (zero point offset 4 actuation channel)</li>
<li>dm##disp is linked to aol#_dmdisp (total dm displacement channel)</li>
<li>dm##disp02 is linked to aol#_dmRM (response matrix actuation channel)</li>
</ul></li>
<li><p><strong>load Memory</strong> (<code>M</code> in <code>Top Menu</code> screen). The dm performs the symbolic links to the DM channels.</p></li>
<li><p><strong>link to WFS camera</strong> (<code>wfs</code> to <code>Loop Configuration</code> screen). Select the WFS shared memory stream.</p></li>
</ul>
</div>
<div id="acquiring-a-response-matrix" class="section level2">
<h2><span class="header-section-number">3.4</span> Acquiring a response matrix</h2>
<ul>
<li><p><strong>set response matrix parameters</strong> in <code>Loop Configure</code> screen: amplitude, time delay, frame averaging, excluded frames</p></li>
<li><p><strong>set normalization and Hadmard modes</strong> in <code>Loop Configure</code> screen. Normalization should probably be set to 1.</p></li>
<li><p><strong>start zonal response matrix acquisition</strong> (<code>zrespon</code> in <code>Loop Configure</code> screen). The process runs in tmux session aol#zrepM.</p></li>
</ul>
</div>
</div>
</body>
</html>
