<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Cfits: AO loop control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Cfits
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_src_AOloopControl_README.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">AO loop control </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Overview</h2>
<p>This module allows control of adaptive optics (AO) control loops.</p>
<p>Source code in <a class="el" href="AOloopControl_8c.html">AOloopControl.c</a> and <a class="el" href="AOloopControl_8h.html">AOloopControl.h</a></p>
<p>Main features:</p>
<ul>
<li>uses shared memory to communicate between processes and link to wavefront sensor camera/data and deformable mirrors</li>
<li>multiple loops can run simultaneously, independantly or together</li>
<li>single process can control multiple loops</li>
<li>Can use either CPU(s) or GPU(s) for computations</li>
</ul>
<h2>Step-by-step instruction for typical operation</h2>
<p>Control loops are numbered - this is how multiple loops can work together. &lt;LOOPNB&gt; can take any positive integer value (0, 1, 2, etc...)</p>
<h3>(1) CREATE/EDIT AOloop&lt;LOOPNB&gt;.conf</h3>
<p>The configuration for running the AO loop is in this file. Shared memory images names are specified, as well as loop configuration paramaters.</p>
<p>The function <a class="el" href="AOloopControl_8h.html#a5c3b0bdcff0ed83ed3f9f217b14c014d">AOloopControl_makeTemplateAOloopconf(long loopnb)</a> creates a template that can be edited: </p>
<pre class="fragment">aolmkconf 0
</pre><h3>(2) CREATE MODES</h3>
<p>For purely Fourier Modes: </p>
<pre class="fragment">./mkModes &lt;CPAmax&gt;
</pre><p>The mode file name is fmodes&lt;CPAmax&gt;.fits.</p>
<p>Make sure this name matches the name specified in APloop&lt;LOOPNB&gt;.conf</p>
<h3>(3) FINDING LOOP LATENCY (OPTIONAL)</h3>
<pre class="fragment">./MeasureTD
</pre><p>This script will create the "TimeDelayRM.txt", which gives signal strength as a function of frame delay.</p>
<p>The fist peak of this curve indicates the time delay and should be updated in the acquRespM script below.</p>
<h3>(4) ACQUIRE RESPONSE MATRIX</h3>
<pre class="fragment">./acquRespM
</pre><p>Edit script to change modulation amplitude, number of images per DM state, etc...</p>
<p>The response matrix acquision will go for a large number of iterations, and data is progressively averaged to improve SNR. The last parameter of the acquRespM command in the script is the number of matrixes averaged. You can either wait for all iterations to complete or CTRL-C the process.</p>
<p>output: respm.fits, refwfs.fits</p>
<h3>(5) COMPUTE CONTROL MATRIX</h3>
<pre class="fragment">./cmmake &lt;#modes removed&gt;
</pre><p>output: cmat_&lt;#modes removed&gt;.fits</p>
<p>Also writes eigenvalues in file "eigenv.dat". Check that number of modes removed is consistent with eigenvalues.</p>
<h3>(6) RUN LOOP</h3>
<p>Start TWO instances of the program</p>
<p>In process #1, type : </p>
<pre class="fragment">aolnb &lt;LOOPNB&gt;
aolrun
</pre><p>In process #2, type : </p>
<pre class="fragment">aolnb &lt;LOOPNB&gt;
aolsetgain &lt;loopgain&gt;
aolon
</pre><p>Other useful commands :</p>
<ul>
<li>aolsetmaxlim &lt;maximum value="" for="" each="" mode&gt;=""&gt;</li>
<li>aolsetmultfb &lt;block number&gt;=""&gt; &lt;multiplicative factor&gt;=""&gt;</li>
</ul>
<h3>(7) LAUNCH MONITOR</h3>
<p>Start new process, type: </p>
<pre class="fragment">aolmon &lt;frequ[Hz]&gt; &lt;number of columns&gt;
</pre><p>For each mode, the following info is displayed: </p>
<pre class="fragment">[&lt;gain factor&gt; &lt;limit factor&gt; &lt;multiplier factor&gt;]   &lt;current DM value&gt; &lt;last WFS estimate&gt; &lt;average val&gt; &lt;RMS&gt; 
</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Sep 2 2014 14:01:43 for Cfits by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
